{% extends 'base.html' %}

{% block content %}


    <div class="container">
        <br/>
        <div class="card mb-3">
            <div class="row g-0">
                <div class="col-md-4">
                    <img src="{{ product.image.url }}" class="img-fluid rounded-start" alt="...">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <center>
                            {% if product.is_sale %}
                            <!-- Sales badge -->
                                <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">
                                    Sale
                                </div>
                                <h5 class="card-title">{{ product.name }}</h5>
                                <br/>
                                <p class="card-text">{{ product.description }}</p>
                                <div class="d-flex justify-content-center small text-warning mb-2">
                                    <div class="bi-star-fill"></div>
                                    &nbsp;&nbsp;Sale!&nbsp;&nbsp;
                                    <div class="bi-star-fill"></div>
                                </div>
                                <p class="card-text"><small class="text-body-secondary"><s>${{ product.price }}</s></small></p>
                                <p class="card-text"><small class="text-body-secondary">${{ product.sale_price }}</small></p>
                            {% else %}
                                <h5 class="card-title">{{ product.name }}</h5>
                                <br/>
                                <p class="card-text">{{ product.description }}</p>
                                <p class="card-text"><small class="text-body-secondary">${{ product.price }}</small></p>
                            {% endif %}
                            <button type="button" value="{{ product.id }}" id="add-cart" class="btn btn-secondary">Add to Cart</button>
                        </center>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Javascript Scripting -->
    <script>
        // Check if the button was pressed
        $(document).on('click', '#add-cart', function(e){
            e.preventDefault();
            // Use Ajax to send info to backend without refreshing the webpage
            $.ajax({
                type: 'POST',
                url: "{% url 'cart_add' %}",
                data: {
                    product_id: $('#add-cart').val(),
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    action: 'post'
                },

                success: function(json){
                    console.log(json)
                    document.getElementById("cart_quantity").textContent = json.qty
                },

                error: function(xhr, errmsh, err){

                }


            });
        });

    </script>

{% endblock %}